---
title: 'fish shellã§ROS1/2ã®è¨­å®š'
emoji: ğŸ 
type: tech
topics: [fish, ros, ros1, ros2]
published: true
---

ã¿ãªã•ã‚“ã¯**fish**ã¨ã„ã†shellã‚’ã”å­˜çŸ¥ã§ã—ã‚‡ã†ã‹ï¼Ÿ

https://fishshell.com

fishã¨ã¯**f**riendly **i**nteractive **sh**ellã®ç•¥ã§ã€ãã®åã®é€šã‚Šfriendlyã¤ã¾ã‚Šä½¿ã„ã‚„ã™ã•ã‚’è¬³ã£ãŸshellã§ã™ï¼å€‹äººçš„ã«ã¯ã‚ã¾ã‚Šè¨­å®šã‚’é ‘å¼µã‚‰ãªãã¦ã‚‚ãã‚Œãªã‚Šã«ä¾¿åˆ©ã«ä½¿ãˆã‚‹ã¨ã„ã£ãŸæ„Ÿã˜ã§ã€ãã†ã„ã†ã®é¢å€’ã ãªã¨æ„Ÿã˜ã¦ã„ã‚‹äººã«ãŠã™ã™ã‚ã§ã™ï¼

ä¸€å¿œæ¬ ç‚¹ã‚‚æ›¸ã„ã¦ãŠãã¨ã€POSIXäº’æ›ã§ã¯ãªã„ã®ã§shã‚„bashã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯æ™®é€šã«ã¯å‹•ã‹ã›ãªã„ã“ã¨ã‚„ã€bashã‚„zshã«æ¯”ã¹ã‚‹ã¨æƒ…å ±ãŒå°‘ãªã„ã¨ã„ã†ã®ãŒã‚ã‚Šã¾ã™ï¼å‰è€…ã«ã¤ã„ã¦ã¯[bass](https://github.com/edc/bass) ã¨ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã™ã—ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰ãã‚‰ã„ãªã‚‰ãã®ã¨ãã ã‘bashã«åˆ‡ã‚Šæ›¿ãˆã‚Œã°ã‚ˆã„ã®ã§ã€å€‹äººçš„ã«ã¯ã‚ã¾ã‚Šå›°ã£ã¦ã„ã¾ã›ã‚“ï¼å¾Œè€…ã«ã¤ã„ã¦ã‚‚ã€å°‘ãªã„ã¨ã„ã£ã¦ã‚‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒã‚ã‚Šã¾ã™ã—ã€èª¿ã¹ã‚‹ã¨ãªã‚“ã ã‹ã‚“ã Stack Overflowã‚ãŸã‚ŠãŒå¼•ã£ã‹ã‹ã‚‹ã®ã§ã€è‹±èªãŒã‚ã‚‹ç¨‹åº¦èª­ã‚ã‚Œã°ã‚ã¾ã‚Šå›°ã‚‰ãªã„ã¨æ€ã„ã¾ã™ï¼

fishã®å…¥é–€è¨˜äº‹ã‚’æ›¸ãã¤ã‚‚ã‚Šã¯ãªã„ã®ã§ã€è©³ã—ãçŸ¥ã‚ŠãŸã„æ–¹ã¯ã€Œfish shellã€ã¨ã‹ã§èª¿ã¹ã¦æ‰‹é ƒãªè¨˜äº‹ã‚’èª­ã‚“ã§ã¿ã¦ãã ã•ã„ï¼ä½•ã‹è¨˜äº‹ã‚’ç´¹ä»‹ã§ãã‚‹ã¨ã‚ˆã„ã®ã§ã™ãŒã€è‡ªåˆ†ãŒæœ€åˆã«èª­ã‚“ã è¨˜äº‹ã‚‚å¤§åˆ†è¨˜è¿°ãŒå¤ããªã£ã¦ãã¦ã„ã‚‹^[fishã¯ç¾åœ¨3ç³»ã§ã™ãŒ2ã¨3ã§å¤§ããå¤‰ã‚ã‚Šã¾ã—ãŸã—ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã®fisherã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰ã¯2å›å¤‰ã‚ã‚Šã¾ã—ãŸï¼install(v2) => add(v3) => install(v4)ï¼ˆãªãœæˆ»ã—ãŸï¼‰ï¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚‚ã¡ã‚‡ãã¡ã‚‡ãå¤‰ã‚ã£ã¦ã„ãŸã‚Šï¼]ã®ã§ã‚ã¾ã‚Šå‹§ã‚ã‚‰ã‚Œã‚‹ã‚‚ã®ãŒãªã‹ã£ãŸã‚Šã—ã¾ã™â€¦â€¦ï¼

ã¨ã„ã†ã“ã¨ã§æ—©é€Ÿæœ¬é¡Œã«ï¼ã‚ã¾ã‚Šfishã‚’ä½¿ã£ã¦ã„ã‚‹äººè‡ªä½“å°‘ãªã„ã®ã§ã¯ã¨æ€ã„ã¾ã™ãŒã€ã€ŒROS1/2ä½¿ã†ã‹ã‚‰fishã¯æˆ‘æ…¢ã—ã¦bash/zshä½¿ã£ã¦ã„ã¾ã™ã€ã¿ãŸã„ãªäººã«å‘ã‘ã¦ã€**fishã§ã‚‚ROSã§ãã‚‹ã‚ˆ**ã¨ã„ã†ã“ã¨ã‚’ãŠä¼ãˆã—ã¤ã¤ã€ã‚ã‚ã‚ˆãã°fishä½¿ã†äººå¢—ãˆãŸã‚‰ã„ã„ãªã¿ãŸã„ãªè¨˜äº‹ã§ã™ï¼

## æº–å‚™

ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã¨ã—ã¦ã€ä»¥ä¸‹ã® `command_exist` ã ã‘ç”¨æ„ã—ã¦ãŠãã¾ã™ï¼ã»ã¼è¦‹ãŸã¨ãŠã‚Šã ã¨æ€ã„ã¾ã™ãŒã€ç¬¬1å¼•æ•°ã®ã‚³ãƒãƒ³ãƒ‰ãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’èª¿ã¹ã‚‹é–¢æ•°ã§ã™ï¼

```fish
function command_exist
    if type $argv[1] >/dev/null 2>&1
        return 0
    else
        echo $argv[1]: not found
        return 1
    end
end
```

ä»¥ä¸‹ã®ã‚ˆã†ã«ä½¿ã„ã¾ã™ï¼

```terminal
$ if command_exist echo; echo OK; end
OK
$ if command_exist xxx; echo OK; end
xxx: not found
```

## ROS1

bashã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èª­ã¿ã“ã‚€ãŸã‚ã«ã€ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚ã‚‹ã¨ä¾¿åˆ©ãªã®ã§READMEã«æ²¿ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼

https://github.com/edc/bass

è‡ªåˆ†ã¯ä½•ã¨ãªãæœ€åˆã«fisherã‚’å…¥ã‚Œã¦ã€ç‰¹ã«å›°ã£ã¦ã„ãªã„ã®ã§ãã®ã¾ã¾ä½¿ã£ã¦ã„ã¾ã™ãŒã€oh-my-fishã‚„fundleã§ã‚‚ã„ã„ã¨æ€ã„ã¾ã™ï¼

https://github.com/jorgebucaran/fisher

https://github.com/oh-my-fish/oh-my-fish

https://github.com/danhper/fundle

ROS1ã®è¨­å®šã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼

```fish:ros1.fish
set -l dists
set -a dists kinetic # Ubuntu 16.04
set -a dists melodic # Ubuntu 18.04
set -a dists noetic # Ubuntu 20.04

for dist in $dists
    set -l path /opt/ros/$dist/setup.bash
    if test -f $path
        bass source $path
    end
end

if command_exist roscore
    if set -q ros1_ip
        set -x ROS_HOSTNAME $ros1_ip
    else
        set -x ROS_HOSTNAME localhost
    end

    set -x ROS_MASTER_URI http://$ROS_HOSTNAME:11311

    set -l path /opt/ros/$ROS_DISTRO/share/rosbash/rosfish
    if test -f $path
        source $path
    end

    set -l path ~/catkin_ws/devel/setup.bash
    if test -f $path
        bass source $path
    end
end
```

ä¸€å¿œéƒ¨åˆ†æ¯ã«è§£èª¬ã‚’ï¼

```fish
set -l dists
set -a dists kinetic # Ubuntu 16.04
set -a dists melodic # Ubuntu 18.04
set -a dists noetic # Ubuntu 20.04

for dist in $dists
    set -l path /opt/ros/$dist/setup.bash
    if test -f $path
        bass source $path
        break
    end
end
```

`set -l`ã¯ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã§ã™ï¼`-a`ã¯é…åˆ—ã«å¯¾ã™ã‚‹appendã§ã€ã¡ãªã¿ã«`-p`ãŒprependã§ã™ï¼ä½•ã¨ãªãã®å¯èª­æ€§ã§ã“ã†æ›¸ã„ã¦ã„ã¾ã™ãŒã€ä¸‹ã®ã‚ˆã†ã«ä¸€æ°—ã«æ§‹ç¯‰ã—ãŸã‚Šã€å¤‰æ•°ã‚’ä»‹ã•ãªãã¦ã‚‚ã‚ˆã„ã§ã™ï¼

```fish
set -l dists kinetic melodic noetic
```

```fish
for dist in kinetic melodic noetic
```

`for`æ–‡ã«é–¢ã—ã¦ã¯`do`ã‚„`done`ãŒãªãã¦ã‚ã‹ã‚Šã‚„ã™ããªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ

ï¼ˆã¨ã“ã‚ã§ã€æ”¹ã‚ã¦è¦‹ã‚‹ã¨å°‘ã—Rubyã£ã½ã„ãªã¨æ€ã„ã¾ã—ãŸï¼å€‹äººçš„ã«Rubyã®æ–‡æ³•ã¯çµæ§‹å¥½ããªã®ã§ã€ãã®å…±é€šç‚¹ã«æƒ¹ã‹ã‚ŒãŸã¨ã“ã‚ã‚‚ã‚ã‚‹ã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼Rubyã¯forè‡ªä½“ã‚ã¾ã‚Šæ›¸ã‹ãªã„ã¨ã‹ã¯ã•ã¦ãŠãï¼ï¼‰

---

```fish
    if set -q ros1_ip
        set -x ROS_HOSTNAME $ros1_ip
    else
        set -x ROS_HOSTNAME localhost
    end

    set -x ROS_MASTER_URI http://$ROS_HOSTNAME:11311
```

`set -q`ã§å¤‰æ•°ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã‚’ã—ã¦ã„ã¾ã™ï¼fishã«ã¯**ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«å¤‰æ•°**ã¨ã„ã†å¤‰æ•°ãŒã‚ã‚Šã€ã“ã‚Œã¯å…¨ã¦ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§å…±æœ‰ã•ã‚Œã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆç­‰ã—ã¦ã‚‚ä¿æŒã•ã‚Œç¶šã‘ã¾ã™ï¼ã“ã®æ€§è³ªã‹ã‚‰ã‚·ã‚§ãƒ«ç­‰ã®è¨­å®šå¤‰æ•°ã¨ã—ã¦ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ï¼
ã¾ã•ã«`ros1_ip`ãŒãã®ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«å¤‰æ•°ã¨ã—ã¦ã‚»ãƒƒãƒˆã•ã‚Œã‚‹ã“ã¨ãŒæƒ³å®šã•ã‚Œã¦ãŠã‚Šã€`set -U ros1_ip xxx.xxx.xxx.xxx`ã¨ã™ã‚‹ã¨ã€ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆè‡ªä½“ã®è©•ä¾¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒã‚ã‚‹ã®ã§å³åº§ã¨ã¯ã„ã‹ãªã„ã‚‚ã®ã®ã€æ–°ãŸã«ã‚¿ãƒ–ã‚’é–‹ã„ãŸã‚Šã€æ—¢ã«é–‹ã„ã¦ã„ã‚‹ã‚‚ã®ã§ã‚‚`exec fish`ç­‰ã§ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚Œã°è¨­å®šãŒåæ˜ ã•ã‚Œã‚‹ã®ã§éå¸¸ã«ä¾¿åˆ©ã§ã™ï¼

- ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«å¤‰æ•°ã«ã¤ã„ã¦ã®å‚è€ƒ

https://fishshell.com/docs/current/#more-on-universal-variables

---

```fish
    set -l path /opt/ros/$ROS_DISTRO/share/rosbash/rosfish
    if test -f $path
        source $path
    end
```

`roscd`ç­‰ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã¨ã€è£œå®Œã‚’åŠ¹ã‹ã›ã‚‹ãŸã‚ã«èª­ã¿è¾¼ã¿ã¾ã™ï¼ã“ã‚Œã¯fishã‚¹ã‚¯ãƒªãƒ—ãƒˆãªã®ã§ã€bassã¯ä¸è¦ã§ã™ï¼ä¸€æ™‚æœŸã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå£Šã‚Œã¦ã„ã¦GitHubã‹ã‚‰æœ€æ–°ã®ãƒ•ã‚¡ã‚¤ãƒ«å–ã£ã¦ã“ãªã„ã¨å‹•ã‹ãªã„ã“ã¨ã‚‚ã‚ã‚Šã¾ã—ãŸãŒã€~~æœ€è¿‘ã¯å®‰å®šã—ã¦ã„ã¾ã™~~ï¼
ã¨æ€ã£ã¦ã„ãŸã‚‰è£œå®ŒãŒä¸Šæ‰‹ãå‹•ã‹ãªãã¦ã€git logè¦‹ã¦ãŸã‚‰ãƒã‚°è¦‹ã¤ã‘ãŸã®ã§PRé€ã‚Šã¾ã—ãŸï¼

https://github.com/ros/ros/pull/279

---

```fish
    set -l path ~/catkin_ws/devel/setup.bash
    if test -f $path
        bass source $path
    end
```

ã“ã¡ã‚‰ã¯fishã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒåã‹ã‚Œãªã„ã®ã§ã€bassã‚’ä½¿ã£ã¦èª­ã¿è¾¼ã¿ã¾ã™ï¼

## ROS2

```fish:ros2.fish
set -l dists
set -a dists dashing # Ubuntu 18.04
set -a dists eloquent # Ubuntu 18.04
set -a dists foxy # Ubuntu 20.04

for dist in $dists
    set -l path /opt/ros/$dist/setup.bash
    if test -f $path
        bass source $path
    end
end

if command_exist ros2
    if command_exist register-python-argcomplete
        register-python-argcomplete --shell fish ros2 | source
    end

    set -l path ~/ros2/install/setup.bash
    if test -f $path
        bass source $path
    end
end
```

ã»ã¼ROS1ã¨åŒã˜ãªã®ã§ã»ã¨ã‚“ã©çœç•¥ã—ã¾ã™ãŒä¸€ç®‡æ‰€ã ã‘ï¼

```fish
    if command_exist register-python-argcomplete
        register-python-argcomplete --shell fish ros2 | source
    end
```

`register-python-argcomplete`ã¯argcompleteã¨ã„ã†PyPiãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¸€éƒ¨ã§ã€ã‚³ãƒãƒ³ãƒ‰å¼•æ•°ã‚’æ‰±ã†ã®ã«ä¾¿åˆ©ãªæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹argparseã‹ã‚‰ã‚³ãƒãƒ³ãƒ‰è£œå®Œã‚’ä½œã£ã¦ãã‚Œã‚‹ã‚„ã¤ã§ã™ï¼

https://pypi.org/project/argcomplete/

argcompleteã¯fishã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ãã‚Œã¦ã„ã‚‹ã®ã§ã€ãƒ‘ã‚¤ãƒ—ã‚’é€šã—ã¦`source`ã§èª­ã¿è¾¼ã‚ã°ã‚ˆã„ã§ã™ï¼

## ROS1 + ROS2

ROS1ã€ROS2ã®ã©ã¡ã‚‰ã‹ã ã‘ã‚’ä½¿ã†ãªã‚‰ã“ã‚Œã‚‰ã§ååˆ†ã§ã™ãŒã€è‡ªåˆ†ã¯dotfileã‚’GitHubã«ä¸Šã’ã¦è¤‡æ•°ã®ç’°å¢ƒã§å…±æœ‰ã—ã¦ã„ã‚‹ã®ã§ã€æ§˜ã€…ãªç’°å¢ƒã§ä½¿ã„ã‚„ã™ã„ã‚ˆã†ã«ã—ã¾ã—ãŸï¼
ã¾ãšã€ROS1ã€ROS2ãã‚Œãã‚Œã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€`ros1.fish`, `ros2.fish`ã¨ã—ã¦åˆ‡ã‚Šå‡ºã—ã¦ã€ä»¥ä¸‹ã®`ros.fish`ã‹ã‚‰æ¡ä»¶ã«å¿œã˜ã¦å‘¼ã³åˆ†ã‘ã¦ã„ã¾ã™ï¼

```fish:ros.fish
set -e ROS_DISTRO

function ros1_load
    source $FISH_SCRIPTS_DIR/ros1.fish
end

function ros2_load
    source $FISH_SCRIPTS_DIR/ros2.fish
end

if set -q use_only_ros1 && test $use_only_ros1 -ne 0
    ros1_load
    echo "ROS1 (ROS_MASTER_URI: $ROS_MASTER_URI)"
else if set -q use_only_ros2 && test $use_only_ros2 -ne 0
    ros2_load
    echo ROS2
end
```

`use_only_ros1(2)`ã¯ã¾ãŸã‚‚ã‚„ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«å¤‰æ•°ã§ã™ï¼ã“ã®ç’°å¢ƒã§ã¯ã©ã¡ã‚‰ã‹ç‰‡æ–¹ã—ã‹ä½¿ã‚ãªã„ã¨æ±ºã¾ã£ã¦ã„ã‚Œã°ã€å¤‰æ•°ã‚’ã‚»ãƒƒãƒˆã—ã¦ãŠã„ã¦èµ·å‹•æ™‚ã«è¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã™ï¼
ã©ã¡ã‚‰ã‚‚ä½¿ã†å ´åˆã€å‹æ‰‹ã«èª­ã¾ã‚Œã¦ã‚‚å›°ã‚‹ã®ã§ã€`ros1(2)_load`ã‚’æ˜ç¤ºçš„ã«èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ã—ã¾ã—ãŸï¼

## ãŠã‚ã‚Šã«

`rosfish`ã«**ãƒã‚°ãŒãªã‘ã‚Œã°**ã€fishã§ã‚‚ã¡ã‚ƒã‚“ã¨è£œå®ŒãŒåŠ¹ãã®ã§ã€fishæœ¬æ¥ã®ä½¿ã„ã‚„ã™ã•ã¨ç›¸ã¾ã£ã¦çµæ§‹å¿«é©ã«å‹•ã‹ã›ã‚‹ã¨æ€ã„ã¾ã™ï¼ç‰¹ã«ros2ã®æ–¹ã¯argcompleteã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã€`rosfish`ã‚ˆã‚Šã‚‚å®‰å®šã—ã¦ã„ã‚‹ã§ã—ã‚‡ã†ï¼
